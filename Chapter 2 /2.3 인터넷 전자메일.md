# 2.3 인터넷 전자메일
일반 우편과 마찬가지로 전자메일은 비동기적인 통신 매체다.<br/>
일반 우편과 다르게 전자메일은 분배가 쉽고, 빠르고, 저렴하다.<br/>

## 인터넷 메일 시스템의 상위 레벨 개념
- 3가지 주요 요소
  - **사용자 에이전트(user agent)**
    - 대표적인 예로, 마이크로소프트 아웃룩(outlook), 애플 메일, 지메일(Gmail) 등 존재
  - **메일 서버(mail server)**
    - 전자메일 인프라스트럭처의 중심
    - `메일박스(mailbox)`를 갖고 있다.
  - **SMTP(Simple Mail Transfer Protocol)**
    - 인터넷 전자메일을 위한 주요 애플리케이션 계층 프로토콜
    - 메일 전송하는 데 TCP의 신뢰적인 데이터 전송 서비스를 이용
<br/>

<p align="center"><img width="400" src="https://github.com/user-attachments/assets/e07952f6-dd16-4110-b910-282fffccf6a8">

<br/>
<br/>

## 2.3.1 SMTP
`SMTP`는 송신자의 메일 서버로부터 수신자의 메일 서버로 메시지를 전송한다.<br/>
> SMTP는 HTTP보다 훨씬 오래되었다, 즉 여러 장점이 있지만 낡은 특성을 가진 오래된 기술
<br/>

예를 들어, SMTP는 모든 메일 메시지의 몸체는 단순한 7비트 ASCII여야 한다는 단점<br/>
-> 과거에는 대용량 첨부파일을 보내지 않아 의미가 있었으나 현대에는 이 제한이 문제를 일으킨다.<br/>
<br/>

### **SMTP 기본 동작 과정 시나리오**<br/>
앨리스가 간단한 ASCII 메시지를 밥에게 보내는 시나리오<br/>

1. 앨리스는 전자 메일 사용자 에이전트를 수행하고, 밥의 전자 메일 주소를 제공하여 메시지를 보내라고 명령한다.<br/>

2. 앨리스의 사용자 에이전트는 메시지를 그녀의 메일 서버에게 보내고, 그곳에서 메시지는 메시지 큐에 놓인다.<br/>

3. 앨리스의 메일 서버에서 동작하는 SMTP의 클라이언트 측은 메시지 큐에 있는 메시지를 본다.<br/>
   밥의 메일 서버에서 수행되고 있는 SMTP 서버에게 TCP 연결을 설정한다.<br/>
   
4. 초기 SMTP 핸드셰이킹 이후에 SMTP 클라이언트는 앨리스의 메시지를 TCP 연결로 보낸다.<br/>

5. 밥의 메일 서버 호스트에서 SMTP의 서버 측은 메시지를 수신한다. 밥의 메일 서버는 그 메시지를 밥의 메일 박스에 놓는다.<br/>

6. 밥은 편한 시간에 그 메시지를 읽기 위해 사용자 에이전트를 시동한다.<br/>

<br/>

<p align="center"><img width="600" src="https://github.com/user-attachments/assets/b683f100-cbb9-451d-b949-d09dbb191a4b">

<br/>
<br/>

> 💡SMTP는 메일을 보낼 때 두 메일 서버가 먼 거리에 떨어져 있더라도 중간 메일 서버를 사용하지 않음<br/>
<br/>

### **SMTP가 메시지를 전송하는 과정**<br/>
SMTP 프로토콜은 마주본(face-to-face) 사람의 상호작용에 이용되는 프로토콜과 유사<br/>

1. 클라이언트 SMTP는 서버 SMTP의 **25번 포트로 TCP 연결을 설정**
   > 만약 서버가 죽어 있으면 클라이언트는 나중에 다시 시도
2. 연결이 설정되면 서버와 클라이언트는 애플리케이션 계층 핸드셰이킹을 수행
   > 이 과정 동안에 SMTP 클라이언트는 송/수신자의 전자메일 주소 제공
3. 클라이언트가 메시지를 보낸다.
   > 이 때, 오류 없이 메시지를 전달하기 위해 TCP 신뢰적 데이터 전송 서비스에 의존
4. 더 이상 보낼 메시지가 없다면 TCP에 연결 닫을 것을 명령
<br/>

### SMTP 클라이언트(C)와 SMTP 서버(S) 사이의 메시지 전달 과정 예
> SMTP는 지속(persistent) 연결을 사용한다
- 클라이언트 호스트 이름: crepes.fr
- 서버의 호스트 이름: hamburger.edu
- C: 다음에 나오는 ASCII 텍스트 라인은 **클라이언트가** TCP 소켓으로 보내는 라인
- S: 다음에 나오는 ASCII 텍스트 라인은 **서버가** TCP 소켓으로 보내는 라인
<br/>

```
S:  220 hamburger.edu
C:  HELO crepes.fr
S:  250 Hello crepes.fr, pleased to meet you
C:  💡MAIL FROM: <alice@crepes.fr>
S:  250 alice@crepes.fr ... Sender ok
C:  💡RCPT TO: <bob@hamburger.edu>
S:  250 bob@hamburger.edu ... Recipient ok
C:  💡DATA
S:  354 Enter mail, end with ”.” on a line by itself
C:  Do you like ketchup?
C:  How about pickles?
C:  .
S:  250 Message accepted for delivery
C:  💡QUIT
S:  221 hamburger.edu closing connection
```
<br/>

## 2.3.2 메일 메시지 포맷
### 헤더 라인
전자메일을 보낼 때 주변 정보가 포함된 헤더가 메시지 몸체 앞에 오게 된다.<br/>
> 헤더 라인과 메시지 몸체는 빈 줄(CRLF)로 분리<br/>

HTTP처럼 각 헤더 라인은 키워드, 콜론, 값의 순서로 구성되고 읽을 수 있는 텍스트를 포함한다.<br/>
> 키워드는 반드시 필요한 것도 있고, 선택사항도 있다.<br/>

💡필수 헤더로는 `FROM:`, `TO:`가 있다.
<br/>

일반 메시지 헤더는 다음과 같다.
```
From: alice@crepes.fr
To: bob@hamburger.edu
Subject: Searching for the meaning of life.

Message(헤더 라인과 빈 줄로 분리된 후 메시지 몸체가 나타난다.)
```
<br/>

## 2.3.3 메일 접속 프로토콜
