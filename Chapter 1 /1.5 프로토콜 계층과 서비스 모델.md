# 1.5 프로토콜 계층과 서비스 모델
## 1.5.1 계층 구조
시스템이 계층 구조를 가질 때, 그 계층이 제공하는 서비스의 구현을 변경하는 것은 쉽다.<br/>
어떤 한 계층의 구현이 변하더라도 시스템의 나머지 부분은 변하지 않는다.<br/>

> 💡계층구조는 크고 복잡한 시스템의 잘 정의된 특정 부분을 논의할 수 있게 해주며, 이러한 단순화는 매우 중요하다.
<br/>

- 항공 시스템 예
- 아래 그림은 티켓 구입부터 수하물 검사 ~ 비행 ~ 짐을 찾는 일련의 항공 시스템 과정을 계층으로 나눈 것
  - 탑승구 기능이 변해도 **탑승구 계층은 여전히 같은 기능을 제공**하고, 시스템의 나머지 부분은 변하지 않는다.
  - 예를 들어, 탑승/하차 순서를 키 순서대로 한다고 가정해도 **사람이 타고 내리는** 기능은 동일하게 제공한다.
<br/>

<p align="center"><img width="600" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/912e6fa6-94e1-4c51-96a0-c979264b6118">

<br>
<br/>

### 프로토콜 계층화
네트워크 프로토콜 설계 구조를 제공하기 위해, 네트워크 설계자는 프로토콜을 `계층(layer)`으로 조직한다.<br/>
<br/>

- 각 프로토콜은 한 계층에 속한다.
- 한 계층이 상위 계층에 제공하는 `서비스(service)`에 관심을 갖고, 이것을 계층의 `서비스 모델(service model)`이라 한다.
- 각 계층은 **(1)그 계층 내부에서 어떤 동작을 수행하거나**, **(2)직접 하위 계층의 서비스를 사용한다.**
<br/>

#### 프로토콜 계층화의 이점과 결점
- 이점
  - `모듈화`는 시스템 구성요소의 갱신을 더 쉽게 해준다.
- 결점
  - 한 계층의 기능이 하위 계층과 기능적으로 `중복`된다는 것
  - 어느 한 계층에서의 기능이 다른 계층에만 존재하는 정보를 필요로 할 수 있다는 것(계층 분리 목적에 위배)
 
<br/>

#### 프로토콜 스택(protocol stack)
📌 다양한 계층의 프로토콜을 모두 합하여 `프로토콜 스택`이라 한다.
<br/>

- 인터넷 프로토콜 스택은 5개의 계층으로 구성

<p align="center"><img width="300" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/27ff024f-a836-42fa-b9be-9df7f7537307">

<br/>
<br/>

### 애플리케이션 계층(application layer)
📌 네트워크 애플리케이션과 애플리케이션 계층 프로토콜이 있는 곳
<br/>

- 인터넷의 애플리케이션 계층
  - `HTTP`(웹 문서 요청과 전송), `SMTP`(전자메일 전송), `FTP`(종단 시스템 간의 파일 전송) 같은 많은 프로토콜 포함
- 애플리케이션 계층 프로토콜
  - 여러 종단 시스템에 분산되어 있어서 한 종단 시스템에 있는 애플리케이션이 다른 종단 시스템에 있는 애플리케이션과<br/>
    **정보 패킷(= 메시지(message))을** 교환하는 데 사용
<br/>

### 트랜스포트 계층(transport layer)
📌 클라이언트와 서버 간에 애플리케이션 계층 메시지를 전송하는 서비스를 제공
<br/>

- 인터넷에는 `TCP`와 `UDP`라는 두 가지 트랜스포트 프로토콜이 있으며 이들은 애플리케이션 계층 메시지를 전달한다.
  - `TCP`: 애플리케이션에 **연결지향형 서비스**를 제공
    - 이 서비스는 목적지로의 애플리케이션 계층 메시지 **전달 보장과 흐름 제어**를 포함
    - 긴 메시지를 짧은 메시지로 나누고 혼잡 제어 기능을 제공하여 네트워크가 혼잡할 때 출발지 전송률을 줄인다.
  - `UDP`: 애플리케이션에 **비연결형 서비스**를 제공
    - 이 서비스는 신뢰성, 흐름 제어, 혼잡 제어를 제공하지 않는 아주 간단한 서비스
<br/>

> 💡이 책에서는 트랜스포트 계층 패킷을 `세그먼트(segment)`라고 한다.
<br/>

### 네트워크 계층(network layer)
📌 한 호스트에서 다른 호스트로 `데이터그램(datagram)`을 라우팅하는 책임을 진다.
<br/>

출발지 호스트에서 트랜스포트 계층 프로토콜(TCP 또는 UDP)은 트랜스포트 계층 세그먼트와 목적지 주소를 네트워크 계층에 전달<br/>
네트워크 계층은 목적지 호스트의 트랜스포트 계층으로 세그먼트를 운반하는 서비스를 제공<br/>
<br/>

- 네트워크 계층의 두 가지 주요 요소
  - `IP 프로토콜`
    - IP 데이터그램의 필드를 정의하며 종단 시스템과 라우터가 이 필드에 어떻게 동작하는지를 정의하는 프로토콜
    - 오직 하나의 IP 프로토콜이 있고 네트워크 계층을 가진 모든 인터넷 요소는 IP 프로토콜을 수행해야만 한다.
  - `라우팅 프로토콜`
    - 출발지와 목적지 사이에서 데이터그램이 이동하는 경로를 결정하는 라우팅 프로토콜을 포함
    - 한 네트워크 내부에서 네트워크 운용자는 원하는 어떠한 라우팅 프로토콜이라도 수행할 수 있다.
<br/>

> 💡네트워크 계층이 IP 및 여러 라우팅 프로토콜을 모두 갖고 있지만, IP가 인터넷을 함께 묶는 역할을 해서 흔히 `IP 계층`으로 불린다.
<br/>

### 링크 계층(link layer)
📌 전체 프레임을 한 네트워크 요소에서 이웃 네트워크 요소로 이동시키는 것
<br/>

- 경로상의 한 노드에서 다른 노드로 패킷을 이동시키기 위해 네트워크 계층은 **링크 계층 서비스에 의존**해야 한다.
  1. 각 노드(호스트 혹은 패킷 스위치)에서 네트워크 계층은 데이터그램을 아래 링크 계층으로 보낸다.
  2. 링크 계층은 그 데이터그램을 경로상의 다음 노드에 전달한다.
  3. 다음 노드에서 링크 계층은 그 데이터그램을 상위 네트워크 계층으로 보낸다.
<br/>

- 링크 계층에서 제공하는 서비스는 그 링크에서 채용된 특정 링크 계층 프로토콜에 의해 결정된다.
  - e.g.) 어떤 프로토콜은 송신 노드 -> 수신 노드까지 하나의 링크를 통해 신뢰적 전송을 제공
  - 프로토콜의 예로는 `이더넷`, `와이파이`, `DOCSIS` 등이 있다.
  - 데이터그램이 출발지에서 목적지로 가는데 여러 링크를 거치므로 데이터그램은 경로상의<br/>
    각기 다른 링크에서 다른 링크 계층 프로토콜에 의해 처리될 수 있다.
<br/>

> 💡이 책에서는 링크 계층 패킷을 `프레임(frame)`이라 한다.
<br/>

### 물리 계층(physical layer)
📌 프레임 내부의 각 비트를 한 노드에서 다음 노드로 이동시키는 것
<br/>

- 이 계층의 프로토콜들은 링크에 의존하고 더 나아가 링크의 실제 전송 매체에 의존한다.
  - e.g.) 이더넷은 여러 가지 물리 계층 프로토콜을 갖는다.(꼬임쌍선용, 동축케이블용, 광케이블용 등)
<br/>

## 1.5.2 캡슐화(encapsulation)
<p align="center"><img width="600" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/1815dd9b-3499-4a4c-b5ef-0bd21f0e3ca3">

<br/>

위 그림은 송신 종단 시스템으로부터 링크 계층 스위치와 라우터를 거치며 수신 종신 시스템까지 물리적 경로<br/>
- 라우터와 링크 계층 스위치
  - 둘 다 패킷 교환기다.
  - 종단 시스템과 비슷하게 네트워킹 하드웨어와 소프트웨어를 계층으로 구성한다.
    - 그러나 프로토콜 스택의 모든 계층을 구현하지는 않고 일반적으로 하위 계층을 구현한다.
    - 그림에서 링크 계층 스위치는 1, 2 계층을 구현하고 라우터는 1~3 계층을 구현한다.
<br/>

### 캡슐화 과정
1. 송신 호스트에서 `애플리케이션 계층 메시지(M)`는 트랜스포트 계층으로 보내진다.
2. 트랜스포트 계층은 메시지에 수신 측 트랜스포트에서 사용될 추가 정보(트랜스포트 계층 헤더, _H<sub>t</sub>_)을 더한다.
  > 💡 `트랜스포트 계층 세그먼트(transport-layer segment)`<br/>
  >  - 메시지(M) + 수신 측 트랜스포트에서 사용될 추가 정보(트랜스포트 계층 헤더, _H<sub>t</sub>_)으로 구성<br/>
  >  - 트랜스포트 계층 세그먼트는 애플리케이션 계층 메시지(M)를 **캡슐화**한다. <br/>
  >  - 추가된 정보<br/>
  >    - 수신 측의 트랜스포트 계층이 그 메시지를 적절한 애플리케이션으로 보내도록 하는 정보<br/>
  >    - 메시지의 비트들이 변경되었는지를 수신자가 결정하게 하는 오류 검출 비트 포함<br/>
3. 트랜스포트 계층은 세그먼트를 네트워크 계층으로 보내며 네트워크 계층은 출발지와 목적지 종단 시스템과 동일한<br/>
  헤더 정보(_H<sub>n</sub>_)를 추가하여 `네트워크 계층 데이터그램(network-layer datagram)`을 만든다.
4. 데이터그램은 링크 계층으로 전달되고 링크 계층은 자신의 헤더 정보를 추가해 `링크 계층 프레임(link-layer frame)`을 만든다.
<br/>

- 따라서 우리는 각 계층에서 패킷은 헤더 필드와 `페이로드 필드(payload field)`라는 두 가지 형태를 가지는 것을 알 수 있다.
  - 페이로드는 일반적으로 그 계층 상위로부터의 패킷
<br/>

> 💡실제 캡슐화 과정은 이보다 더 복잡할 수 있다.<br>
>  큰 메시지는 여러 개의 트랜스포트 계층 세그먼트로 분할 될 수 있고, <br/>
>  그들 각각은 다시 여러 개의 네트워크 계층 데이터그램으로 분할 될 수 있다.<br/>
>  이후 수신 측에서 각 세그먼트는 분할된 데이터그램들로 재구성될 것
