# 1.3 네트워크 코어
`네트워크 코어`: 인터넷의 종단 시스템을 연결하는 패킷 스위치와 링크의 그물망(mesh)<br/>

<p align="center"><img width="400" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/61c9e443-1d2f-40cc-bd38-f23227a1b3cc">

<br/>
<br/>

## 1.3.1 패킷 교환
`패킷(packet)`: 종단 시스템들이 서로 교환하는 `메시지(message)`(제어기능, 전자메일 메시지, JPEG 이미지 같은 데이터들)
- 출발지 종단 시스템에서 목적지 종단 시스템으로 보내기 위한 메시지를 패킷으로 분할한다.
- 각 패킷은 **통신 링크**와 **패킷 스위치**를 거치게 된다.
- 패킷은 링크의 최대 전송률과 같은 속도로 각각의 통신 링크에서 전송된다.
> 💡종단 시스템 혹은 패킷 스위치가 **R비트/초**의 속도로 링크에서 **L비트**의 패킷을 송신한다면<br/>
> &emsp; 패킷을 전송하는데 걸리는 시간은 **L/R초**

<br/>

### 저장-후-전달
대부분의 패킷 스위치는 `저장-후-전달 전송(store-and-forward transmission)` 방식을 이용한다.<br/>
`저장-후-전달`은 스위치가 출력 링크로 패킷의 첫 비트를 전송하기 전에 전체 패킷을 받아야함을 의미<br/>

<p align="center"><img width="600" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/07f73758-0e71-49e2-b52f-55b752a0ead5">

<br/>
<br/>

위 그림은 출발지에서 목적지까지의 입/출력 링크가 유일한 아주 간단한 예시<br/>
- 전송할 패킷은 3개, 각각은 L비트로 구성
- 현재 그림 시점은 패킷1의 일부분만 전송한 상태로 라우터는 수신한 비트를 전송할 수 없다.
  - 대신 그 패킷의 비트를 저장하고 있다가 패킷의 모든 비트를 수신한 후에 출력 링크로 패킷을 전송한다.
- 출발지 -> 목적지에서 수신을 완료할 때까지 경과 시간
  - 여기서 전파지연은 우선 무시한다.(전파지연에 관한 내용은 이후 알아볼 예정)
  1. 출발지는 `시각 0`에 전송 시작
  2. `L/R초`에 출발지는 전체 패킷을 전송했고 라우터에서 수신되어 저장되었다.(가정: 전파지연 X)
  3. `2L/R초` 시각에 라우터는 전체 패킷을 전송했고 수신 시스템이 전체 패킷을 수신했다.
  4. 따라서 전체 지연은 2L/R 이 된다.
  > 💡만약, 저장-후-전달 방식을 사용하지 않아 라우터에서 전체 패킷을 기다리지 않았다면?</br>
  > &emsp; 비트가 도착하자마자 전달하기 때문에 전체 지연은 L/R이 될 것이다.
</br>

- 패킷 3개를 모두 수신할 때까지 경과된 전체 시간
  1. `L/R 시각`: 라우터에서 첫 번째 패킷 전송 시작, 출발지에서 두 번째 패킷 송신 시작
  2. `2L/R 시각`: 라우터에서 두 번째 패킷 전송 시작, 출발지에서 세 번째 패킷 송신 시작
  3. `3LR 시각`: 라우터에서 세 번째 패킷 전송 시작
  4. `4LR 시각`: 목적지에서 모든 패킷 수신 완료
> [!NOTE]
> 확장하여 출발지로부터 목적지까지 `N개의 링크`로 구성되고 각각 `전송률이 R`인 경로를 통해 패킷을 전송하는 경우<br/>
> <p align="center"><img width="200" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/f9e6d6d2-fc69-4fe4-8c2f-62552f00dbda">

<br/>

### 큐잉 지연과 패킷 손실
연속된 `N개의 링크`를 통해 송신된 `P개의 패킷`의 지연은 어떻게 될까?<br/>
<br/>

#### 패킷 스위치
- 접속된 여러 개의 링크를 갖는다.
- `출력 버퍼(출력 큐)`를 갖고 있으며 그 링크로 송신하려고 하는 패킷을 저장하고 있다.

<br/>

#### 큐잉 지연(queuing delay)
`큐잉 지연`: 패킷이 저장-후-전달 지연뿐만 아니라, 전송하려는 링크가 사용중일 경우 `출력 버퍼`에서 대기해야 하는 상황
- 가변적이고 네트워크 혼잡 정도에 따른다.
- 버퍼 공간의 크기가 유한하기 때문에 버퍼가 이미 가득 차 있을 경우가 존재할 수 있다.
  - 이 경우 `패킷 손실(packet loss)` 발생
- 아래 그림은 라우터에 도착하는 패킷의 전송률이 15 Mbps를 초과해 `큐잉 지연`이 발생하는 상황<br/>

<p align="center"><img width="600" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/6f5b65ca-3260-4751-9130-72482e8f9813">

<br/>
<br/>

### 포워딩 테이블과 라우팅 프로토콜
라우터는 어떻게 패킷을 어느 링크로 전달해야 하는지를 결정하는가?<br/>
<br/>

#### 포워딩 테이블(forwarding table)
인터넷에서 모든 종단 시스템은 `IP 주소`를 갖는다.<br/>
출발지에서 목적지로 패킷을 보내고자 할 때, 출발지는 `패킷의 헤더`에 목적지의 IP 주소를 포함한다.<br/>

- 각 라우터는 **목적지 주소**(혹은 목적지 주소의 일부)를 라우터의 출력 링크로 매핑하는 `포워딩 테이블`을 가지고 있다.
  - 라우터가 패킷을 올바른 출력 링크로 전송하는 과정
  1. 패킷이 라우터에 도착
  2. 라우터는 패킷의 IP 주소를 조사
  3. 찾은 목적지 IP 주소를 이용하여 포워딩 테이블 검색
  4. 패킷을 출력 링크로 전송

<br/>

#### 라우팅 프로토콜(routing protocol)
인터넷은 자동으로 포워딩 테이블을 설정하는데 이용되는 여러 특별한 라우팅 프로토콜을 갖고 있다.<br/>
`라우팅 프로토콜`은 각 라우터로부터 각 목적지까지의 최단 경로를 결정하고 라우터에 포워딩 테이블을 설정하는데<br/>
이 최단 경로 결과를 이용한다.(자세한 내용은 이후 5장에서)
