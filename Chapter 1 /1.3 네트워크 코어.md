# 1.3 네트워크 코어
`네트워크 코어`: 인터넷의 종단 시스템을 연결하는 패킷 스위치와 링크의 그물망(mesh)<br/>

<p align="center"><img width="400" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/61c9e443-1d2f-40cc-bd38-f23227a1b3cc">

<br/>
<br/>

## 1.3.1 패킷 교환
`패킷(packet)`: 종단 시스템들이 서로 교환하는 `메시지(message)`(제어기능, 전자메일 메시지, JPEG 이미지 같은 데이터들)
- 출발지 종단 시스템에서 목적지 종단 시스템으로 보내기 위한 메시지를 패킷으로 분할한다.
- 각 패킷은 **통신 링크**와 **패킷 스위치**를 거치게 된다.
- 패킷은 링크의 최대 전송률과 같은 속도로 각각의 통신 링크에서 전송된다.
> 💡종단 시스템 혹은 패킷 스위치가 **R비트/초**의 속도로 링크에서 **L비트**의 패킷을 송신한다면<br/>
> &emsp; 패킷을 전송하는데 걸리는 시간은 **L/R초**

<br/>

### 저장-후-전달
대부분의 패킷 스위치는 `저장-후-전달 전송(store-and-forward transmission)` 방식을 이용한다.<br/>
`저장-후-전달`은 스위치가 출력 링크로 패킷의 첫 비트를 전송하기 전에 전체 패킷을 받아야함을 의미<br/>

<p align="center"><img width="600" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/07f73758-0e71-49e2-b52f-55b752a0ead5">

<br/>
<br/>

위 그림은 출발지에서 목적지까지의 입/출력 링크가 유일한 아주 간단한 예시<br/>
- 전송할 패킷은 3개, 각각은 L비트로 구성
- 현재 그림 시점은 패킷1의 일부분만 전송한 상태로 라우터는 수신한 비트를 전송할 수 없다.
  - 대신 그 패킷의 비트를 저장하고 있다가 패킷의 모든 비트를 수신한 후에 출력 링크로 패킷을 전송한다.
- 출발지 -> 목적지에서 수신을 완료할 때까지 경과 시간
  - 여기서 전파지연은 우선 무시한다.(전파지연에 관한 내용은 이후 알아볼 예정)
  1. 출발지는 `시각 0`에 전송 시작
  2. `L/R초`에 출발지는 전체 패킷을 전송했고 라우터에서 수신되어 저장되었다.(가정: 전파지연 X)
  3. `2L/R초` 시각에 라우터는 전체 패킷을 전송했고 수신 시스템이 전체 패킷을 수신했다.
  4. 따라서 전체 지연은 2L/R 이 된다.
  > 💡만약, 저장-후-전달 방식을 사용하지 않아 라우터에서 전체 패킷을 기다리지 않았다면?</br>
  > &emsp; 비트가 도착하자마자 전달하기 때문에 전체 지연은 L/R이 될 것이다.
</br>

- 패킷 3개를 모두 수신할 때까지 경과된 전체 시간
  1. `L/R 시각`: 라우터에서 첫 번째 패킷 전송 시작, 출발지에서 두 번째 패킷 송신 시작
  2. `2L/R 시각`: 라우터에서 두 번째 패킷 전송 시작, 출발지에서 세 번째 패킷 송신 시작
  3. `3LR 시각`: 라우터에서 세 번째 패킷 전송 시작
  4. `4LR 시각`: 목적지에서 모든 패킷 수신 완료
> [!NOTE]
> 확장하여 출발지로부터 목적지까지 `N개의 링크`로 구성되고 각각 `전송률이 R`인 경로를 통해 패킷을 전송하는 경우<br/>
> <p align="center"><img width="200" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/f9e6d6d2-fc69-4fe4-8c2f-62552f00dbda">

<br/>

### 큐잉 지연과 패킷 손실
연속된 `N개의 링크`를 통해 송신된 `P개의 패킷`의 지연은 어떻게 될까?<br/>
<br/>

#### 패킷 스위치
- 접속된 여러 개의 링크를 갖는다.
- `출력 버퍼(출력 큐)`를 갖고 있으며 그 링크로 송신하려고 하는 패킷을 저장하고 있다.

<br/>

#### 큐잉 지연(queuing delay)
`큐잉 지연`: 패킷이 저장-후-전달 지연뿐만 아니라, 전송하려는 링크가 사용중일 경우 `출력 버퍼`에서 대기해야 하는 상황
- 가변적이고 네트워크 혼잡 정도에 따른다.
- 버퍼 공간의 크기가 유한하기 때문에 버퍼가 이미 가득 차 있을 경우가 존재할 수 있다.
  - 이 경우 `패킷 손실(packet loss)` 발생
- 아래 그림은 라우터에 도착하는 패킷의 전송률이 15 Mbps를 초과해 `큐잉 지연`이 발생하는 상황<br/>

<p align="center"><img width="600" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/6f5b65ca-3260-4751-9130-72482e8f9813">

<br/>
<br/>

### 포워딩 테이블과 라우팅 프로토콜
라우터는 어떻게 패킷을 어느 링크로 전달해야 하는지를 결정하는가?<br/>
<br/>

#### 포워딩 테이블(forwarding table)
인터넷에서 모든 종단 시스템은 `IP 주소`를 갖는다.<br/>
출발지에서 목적지로 패킷을 보내고자 할 때, 출발지는 `패킷의 헤더`에 목적지의 IP 주소를 포함한다.<br/>

- 각 라우터는 **목적지 주소**(혹은 목적지 주소의 일부)를 라우터의 출력 링크로 매핑하는 `포워딩 테이블`을 가지고 있다.
  - 라우터가 패킷을 올바른 출력 링크로 전송하는 과정
  1. 패킷이 라우터에 도착
  2. 라우터는 패킷의 IP 주소를 조사
  3. 찾은 목적지 IP 주소를 이용하여 포워딩 테이블 검색
  4. 패킷을 출력 링크로 전송

<br/>

#### 라우팅 프로토콜(routing protocol)
인터넷은 자동으로 포워딩 테이블을 설정하는데 이용되는 여러 특별한 라우팅 프로토콜을 갖고 있다.<br/>
`라우팅 프로토콜`은 각 라우터로부터 각 목적지까지의 최단 경로를 결정하고 라우터에 포워딩 테이블을 설정하는데<br/>
이 최단 경로 결과를 이용한다.(자세한 내용은 이후 5장에서)

<br/>

## 1.3.2 회선 교환(circuit switching)
링크와 스위치의 네트워크를 통해 데이터를 이동시키는 방법에는 `회선교환`과 `패킷 교환`이 있다.<br/>
<br/>

- 회선 교환 네트워크에서 종단 시스템간의 통신을 제공하기 위해 경로상에 필요한 자원(버퍼, 링크 전송률)은<br/>
  통신 세션(session) 동안에 확보 또는 예약된다(reserve).
  > 💡 패킷 교환 네트워크에서는 이러한 자원을 예약하지 않는다.
<br/>

- 세션 메시지는 `온디맨드(on-demand)` 방식으로 자원을 요청하고 사용하여 통신 링크에 대한 접속을 위해 기다릴 수 있다.
- 회선 교환 네트워크 예시. `전통적인 전화망`
  - 송신자가 정보를 보내기 전에 네트워크는 송신자와 수신자 간의 연결을 설정해야 한다.
  - 송신자와 수신자 간의 **경로에 있는 스위치들**이 해당 연결 상태를 유지해야 하며, 이 연결이 `회선(circuit)`이다.
  - 연결이 이루어지는 동안 네트워크 링크에 일정한 전송률을 예약한다.
  - 주어진 전송률이 송-수신자 연결을 위해 예약되므로 송신자는 수신자에게 **보장된 일정 전송률**로 데이터 전송 가능
<br/>

- 아래 네트워크는 4개의 회선 스위치가 4개의 링크에 연결되어 있다.
- 각 링크는 4개의 회선을 가지므로 각 연결은 연결이 지속되는 동안 링크 전체 전송 용량의 1/4을 얻는다.
  - e.g.) 이웃한 스위치간에 각 링크가 1Mbps 전송률을 갖느다면 각 회선 교환 연결은 250kbps를 얻는다.<br/>
  > 💡 패킷 교환 네트워크는 일정한 시간 내에 데이터를 전달하는 것을 보장하지 않는다.
<br/>

<p align="center"><img width="600" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/342c5ce1-21be-4fd3-aae9-1fbf233f3b98">

<br/>
<br/>

### 회선 교환 네트워크에서의 다중화
링크 내 한 회선은 `주파수 분할 다중화(FDM)` 혹은 `시 분할 다중화(TDM)`로 구현된다.<br/>
<br/>

#### 주파수 분할 다중화(frequency-division multiplexing, FDM)
- `FDM`에서 링크를 통해 설정된 연결은 그 링크의 주파수 스펙트럼을 공유한다.
- 그 링크는 연결되는 동안 각 연결에 대해 주파수 대역을 고정 제공한다.
- `대역폭(bandwidth)`: 대역의 폭, 전화망에서 일반적으로 4 kHz 폭을 갖는다.

<br/>

#### 시 분할 다중화(time-division multiplexing, TDM)
- `TDM`링크의 경우 시간을 일정 주기의 프레임으로 구분하고 각 프레임은 **고정된 수의 시간 슬롯**을 나타낸다.
- 네트워크가 링크를 통해 하나의 연결을 설정할 때, 네트워크는 모든 프레임에서 시간 슬롯 1개를 그 연결에 할당한다.
- TDM 회선의 전송률은 한 슬롯 안의 비트 수에 프레임 전송률을 곱한 것과 같다
  - e.g.) 링크가 초당 8,000 프레임을 전송하고 각 슬롯이 8비트로 구성 -> 회선 전송률: 64 kbps

<br/>

<p align="center"><img width="600" src="https://github.com/jmKim02/ComputerNetworking_A-Top-Down-Approach/assets/174222202/17c71bab-2bb6-45d3-88e7-952802649347">

<br/>
<br/>

> [!NOTE]
> 패킷 교환 옹호자들은 회선 교환의 경우에 할당된 회선이 `비활용 기간(silent period)에는 놀게 된다고 지적<br/>
> e.g.) 엑스레이 이미지 관찰 중, 통화 중 이야기 중단 시점과 같은 비활용 기간에도 자원을 잡고 있어 낭비된다는 것

<br/>

### 패킷 교환 대 회선 교환
- 패킷 교환 반대자
  - 패킷 교환은 가변적이고 예측할 수 없는 종단 간의 지연(주로 큐잉 지연) 때문에 실시간 서비스에 적합하지 않다

<br/>

- 패킷 교환 옹호자
  - 패킷 교환이 회선 교환보다 **전송 용량의 공유**에서 더 효율적이다
  - 패킷 교환이 **더 간단하고 효율적이며 구현 비용이 적다**

<br/>

- 패킷 교환이 왜 효율적인가?
- e.g.) 10명의 사용자 중 한 사용자만 한 번에 1000비트 패킷을 1000개 생성한다
  - 한 프레임은 10개 슬롯으로 구성, 각 슬롯은 1000비트로 구성된 TDM 회선의 경우
  - 1개의 시간 슬롯만 사용하고 남겨진 9개의 슬롯은 쉬는 상태
  - 이 경우 사용자 데이터 100만 비트를 모두 전송하는데 걸리는 시간은 10초 (링크 전송률: 1 Mbps)
  > 💡패킷 교환의 경우에는 다중화가 요구되지 않아 1 Mbps 링크가 가득 찰 때까지 패킷 계속 보낸다 -> 1초만에 전송

<br/>

- 링크 전송률을 공유하는 두 방식의 가장 큰 차이점
  - 회선 교환이 **요구에 관계없이** 미리 전송 링크의 사용을 할당하는 반면
  - 패킷 교환은 **요구할 때만** 링크의 사용을 할당한다는 것이다.

<br/>

- 패킷 교환 방식에서 링크 전송 능력은 링크에 전송할 패킷을 가진 사용자만이 패킷 기반으로 공유한다.
- 이에 따라 오늘날의 많은 회선 교환 전화망이 패킷 교환으로 전환되고 있는 추세이다.

<br/>

## 1.3.3 네트워크의 네트워크(network of network)
### 접속 ISP
- `접속 ISP`는 DSL, 케이블, FTTH, 와이파이, 셀룰러를 포함하는 다양한 접속 기술을 이용하여 유/무선 연결을 제공한다.
- 접속 ISP는 텔코 혹은 케이블 회사일 필요는 없다, 대신 대학 혹은 회사가 ISP가 될 수 있다.
- 수십억 개의 종단 시스템들과 콘텐츠 제공자들을 접속 ISP로 연결하는 것은 사실상 어렵다.
- 이를 해결하기 위해서는 **접속 ISP들이 서로 연결되어야 하기 때문에** `네트워크의 네트워크`가 탄생하게 되었다.

<br/>

### 네트워크 구조 1
- 모든 접속 ISP를 **하나의 글로벌 통과(transit) ISP**와 연결한다.
- `글로벌 ISP`는 라우터와 전 세계에 이르고 적어도 수십만 개의 접속 ISP와 가까운 곳에 있는 라우터를 갖는 통신 네트워크
- 글로벌 ISP가 확장된 네트워크를 구축하는 데는 당연히 **매우 많은 비용**이 든다.
- 접속 ISP가 글로벌 ISP에게 요금을 지불하는 입장
  - 접속 ISP는 `고객(customer)`
  - 글로벌 ISP는 `제공자(provider)`

<br/>

### 네트워크 구조 2
어느 회사가 수익을 내는 글로벌 ISP를 구축하고 운영한다면 다른 회사도 글로벌 ISP를 구축할 것이 당연하다.<br/>
그로 인해 서로 경쟁하는 자연스러운 현상이 발생하며 네트워크 구조 2로 진화하게 된다.<br/>

- 수십만 개의 접속 ISP와 **다중의 글로벌 ISP**로 구성된다.
- 접속 ISP 입장에서는 당연히 네트워크 구조 1 보다 네트워크 구조 2를 선호한다.
  - 가격과 서비스를 비교하며 경쟁하는 여러 글로벌 ISP 중에서 선택이 가능하기 때문
- 글로벌 ISP들은 서로 연결해야만 한다.
  - 그렇지 않으면 하나의 글로벌 ISP와 연결된 접속 ISP는 다른 글로벌 ISP에 연결된 접속 ISP와 통신할 수 없다.
- 2계층 구조
  - 상위층에 `글로벌 ISP`
  - 하위층에 `접속 ISP`

<br/>

#### 지역 ISP와 1계층 ISP
전 세계의 모든 도시에 존재하는 ISP는 없다.<br/>
대신 어느 주어진 지역에서 그 지역에 있는 접속 ISP들이 연결하는 `지역(regional) ISP`가 있다.<br/>

- 각 지역 ISP는 `1계층(tier-1) ISP`들과 연결된다.
- 1계층 ISP는 글로벌 ISP와 유사
  - 실제로 존재하는 1계층 ISP는 전 세계적으로 모든 도시에 존재하지는 않는다.
